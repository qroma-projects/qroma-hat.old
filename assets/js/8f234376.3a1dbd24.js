"use strict";(self.webpackChunkwww_qroma_project=self.webpackChunkwww_qroma_project||[]).push([[1432],{3613:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>g,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var n=a(4848),s=a(8453),l=a(6187);const i={title:"Qroma Hat App"},r="Qroma Hat App",o={type:"mdx",permalink:"/qroma-hat/app/",source:"@site/src/pages/app/index.md",title:"Qroma Hat App",description:"To connect to your Qroma Lights device, plug it into your computer's USB port",frontMatter:{title:"Qroma Hat App"},unlisted:!1},g={},d=[];function c(e){const t={h1:"h1",p:"p",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"qroma-hat-app",children:"Qroma Hat App"}),"\n",(0,n.jsxs)(t.p,{children:["To connect to your Qroma Lights device, plug it into your computer's USB port\nand click the Connect button. When prompted\nto connect to a serial port, select the entry with the most likely name\n(e.g. something-",(0,n.jsx)("b",{children:"usbserial"}),")."]}),"\n",(0,n.jsx)(l.A,{})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},6187:(e,t,a)=>{a.d(t,{A:()=>J});var n=a(6540),s=a(7733),l=a(3581),i=a(4016),r=a(6786);const o=960,g=540;var d=a(4848);const c=e=>{let{componentState:t}=e;const a=t.grayscaleData,[s,l]=(0,n.useState)("");return console.log("RENDERING GrayscaleConversionOutputImage"),(0,n.useEffect)((()=>{console.log("IN USE EFFECT");const e=document.createElement("canvas");console.log(e),e.width=a.imageWidthInPixels,e.height=a.imageHeightInPixels;const t=e.getContext("2d");if(null===t)return;console.log("CANVAS CTX: "+t);var n=t.createImageData(a.imageWidthInPixels,a.imageHeightInPixels);console.log("IMAGE DATA: "+n);for(let l=0;l<a.dataAsNibbles.length;l++){const e=16*a.dataAsNibbles[l],t=4*l;n.data[t]=e,n.data[t+1]=e,n.data[t+2]=e,n.data[t+3]=255}t.putImageData(n,0,0);const s=e.toDataURL();console.log("CANVAS"),console.log(e),l(s),console.log(`SETTING CANVAS HEIGHT: ${a.imageHeightInPixels}`),console.log(`SETTING CANVAS WIDTH: ${a.imageWidthInPixels}`)}),[t.grayscaleData]),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{style:{width:480,height:270},children:(0,d.jsx)("img",{src:s})})})};var m=a(5674);let p=function(e){return e.lightness="lightness",e.average="average",e.luminosity="luminosity",e}({});const u=e=>e<16?[0,0,0,0]:e<32?[0,0,0,1]:e<48?[0,0,1,0]:e<64?[0,0,1,1]:e<80?[0,1,0,0]:e<96?[0,1,0,1]:e<112?[0,1,1,0]:e<128?[0,1,1,1]:e<144?[1,0,0,0]:e<160?[1,0,0,1]:e<176?[1,0,1,0]:e<192?[1,0,1,1]:e<208?[1,1,0,0]:e<224?[1,1,0,1]:e<240?[1,1,1,0]:[1,1,1,1],h=e=>{const{p1r:t,p1g:a,p1b:n,p2r:s,p2g:l,p2b:i}=e,r=(s+l+i)/3,o=u((t+a+n)/3),g=u(r);return 16*m.Ay.nibble.write(o)+m.Ay.nibble.write(g)},v=e=>{const{p1r:t,p1g:a,p1b:n,p2r:s,p2g:l,p2b:i}=e,r=(s+l+i)/3,o=u((t+a+n)/3),g=u(r);return[m.Ay.nibble.write(o),m.Ay.nibble.write(g)]},x=e=>{const t=e.imageData.width;if(t%2!=0)throw new Error("Image width must be even");if(e.conversionAlgorithm!==p.average)throw new Error("Unsupported GS conversion algorithm: "+e.conversionAlgorithm);const a=e.imageData.height,n=[],s=[];for(let l=0;l<a;l++)for(let a=0;a<t;a+=2){const s=4*(l*t+a),i=e.imageData.data,r=h({p1r:i[s],p1g:i[s+1],p1b:i[s+2],p2r:i[s+4],p2g:i[s+5],p2b:i[s+6]});n.push(r)}for(let l=0;l<a;l++)for(let a=0;a<t;a+=2){const n=4*(l*t+a),i=e.imageData.data,[r,o]=v({p1r:i[n],p1g:i[n+1],p1b:i[n+2],p2r:i[n+4],p2g:i[n+5],p2b:i[n+6]});s.push(r),s.push(o)}return{dataAsUint8Array:new Uint8ClampedArray(n),dataAsNibbles:s,imageHeightInPixels:a,imageWidthInPixels:t,imageLabel:e.imageLabel}},I=e=>{if((e=(e=e.trim()).slice(e.indexOf("<svg"))).startsWith("<svg")&&e.endsWith("svg>")&&(e.includes("http://www.w3.org/2000/svg")||(e=e.replace(/<svg/g,"<svg xmlns='http://www.w3.org/2000/svg'")),(e=(e=(e=(e=(e=(e=(e=e.replace(/<!--.{1,}-->/g,"")).replace(/version=[\"\'](.{0,}?)[\"\'](?=[\s>])/g,"")).replace(/"'(.{1,})'"/g,"'$1'")).replace(/"/g,"'")).replace(/>\s{1,}</g,"><")).replace(/\s{2,}/g," ")).trim()).startsWith("<svg")&&e.endsWith("svg>")))return e=`data:image/svg+xml,${e=(e=e.replace(/&/g,"&amp;")).replace(/[%#<>?\[\\\]^`{|}]/g,encodeURIComponent)}`},S=e=>{const t=(0,n.useRef)(null);return(0,d.jsx)("div",{style:{width:480,height:270},children:(0,d.jsx)("img",{ref:t,src:e.svgAsDataUrl,onLoad:()=>{try{if(null===t||null===t.current)return;const a=document.createElement("canvas");a.width=t.current.naturalWidth,a.height=t.current.naturalHeight;const n=a.getContext("2d");n.drawImage(t.current,0,0);const s=n.getImageData(0,0,a.width,a.height),l=x({imageData:s,conversionAlgorithm:p.average,imageLabel:e.gsImageLabel});console.log(l),e.onGsConvertedData(l)}catch(a){console.log("CANVAS ERROR: "+a)}},height:0,width:0})})};function f(e){const{children:t,value:a,index:n,...l}=e;return(0,d.jsx)("div",{role:"tabpanel",hidden:a!==n,id:`simple-tabpanel-${n}`,"aria-labelledby":`simple-tab-${n}`,...l,children:a===n&&(0,d.jsx)(s.A,{sx:{p:3},children:t})})}function b(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}const j=e=>{let{svgInputText:t}=e;return console.log("svgInputText"),console.log(t),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)("div",{children:(0,d.jsx)(l.A,{id:"outlined-multiline-static",label:"SVG Input",multiline:!0,value:t,fullWidth:!0,inputProps:{style:{fontFamily:"monospace",height:"250px",overflow:"scroll"}}})})})},w=e=>{const[t,a]=n.useState(1),l=async()=>{var t=document.createElement("img");const a=I(e.componentState.svgImageText);t.onload=async()=>{let a=new FileReader;const n=new Blob([e.componentState.svgImageText],{type:"image/svg+xml"});a.readAsDataURL(n),a.onload=function(){const n=a.result;(t=>{try{const a=document.createElement("canvas").getContext("2d");a.drawImage(t,0,0);const n=a?.getImageData(0,0,t.width,t.height),s=x({imageData:n,conversionAlgorithm:p.average,imageLabel:e.componentState.gsImageLabel});e.onNewGrayscaleData(s)}catch(a){console.log("CANVAS ERROR: "+a)}})(t),e.onNewSvgImageAsDataUrl(n)}},t.src=a};return(0,n.useEffect)((()=>{(async()=>{await l()})()}),[e.componentState.svgImageText]),(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(s.A,{sx:{borderBottom:1,borderColor:"divider",height:400},children:[(0,d.jsx)("canvas",{id:"canvas-ImageOutputView",height:0,width:0}),(0,d.jsx)("div",{style:{width:0,height:0},children:(0,d.jsx)(S,{svgAsDataUrl:e.componentState.svgImageAsDataUrl,gsImageLabel:e.componentState.gsImageLabel,onGsConvertedData:t=>{e.onNewGrayscaleData(t)}})}),(0,d.jsx)(s.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,d.jsxs)(i.A,{value:t,onChange:(e,t)=>{a(t)},"aria-label":"basic tabs example",variant:"scrollable",children:[(0,d.jsx)(r.A,{label:"SVG Text",...b(0)}),(0,d.jsx)(r.A,{label:"SVG Image",...b(1)}),(0,d.jsx)(r.A,{label:"Grayscale",...b(2)}),(0,d.jsx)(r.A,{label:"Upload",...b(3)})]})}),(0,d.jsx)(f,{value:t,index:0,children:(0,d.jsx)(j,{svgInputText:e.componentState.svgImageText})}),(0,d.jsx)(f,{value:t,index:1,children:(0,d.jsx)("div",{style:{width:480,height:270},children:(0,d.jsx)("img",{src:e.componentState.svgImageAsDataUrl})})}),(0,d.jsx)(f,{value:t,index:2,children:(0,d.jsx)(c,{componentState:e.componentState})}),(0,d.jsx)(f,{value:t,index:3,children:(0,d.jsx)("div",{children:"Upload"})})]})})};var A=a(3870),T=a(26),y=a(8440),F=a(2909),G=a(3232),D=a(7512),U=a(1523),E=a(5848);const C="LINE1",N=e=>{let{line1:t,svgTemplateInputs:a}=e;return(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full",width:o,height:g,children:[(0,d.jsx)("rect",{width:"100%",height:"100%",fill:"white",stroke:"black",strokeWidth:a.borderWidth,strokeOpacity:"1.0"}),(0,d.jsx)("text",{x:480,y:270,fontSize:a.fontSize,fontFamily:a.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:t})]})},L=(e,t)=>({newSvgText:(0,E.F0)((0,d.jsx)(N,{line1:e,svgTemplateInputs:t})),svgImageLabel:e}),k=e=>{const[t,a]=(0,n.useState)(C),[s,i]=(0,n.useState)("Arial, Helvetica, sans-serif"),[r,o]=(0,n.useState)(160),[g,c]=(0,n.useState)("");return(0,n.useEffect)((()=>{e.svgGenerationInputsUpdateFn(L(t,e.templateInputs))}),[t,e.templateInputs]),(0,d.jsx)(d.Fragment,{children:(0,d.jsx)(U.A,{spacing:2,children:(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 1",value:t,onChange:e=>{const t=e.target.value;a(t)}},"single-line-text-line1-input")})})},R=e=>{let{line1:t,line2:a,svgTemplateInputs:n}=e;return(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full",width:o,height:g,children:[(0,d.jsx)("rect",{width:"100%",height:"100%",fill:"white",stroke:"black",strokeWidth:n.borderWidth,strokeOpacity:"1.0"}),(0,d.jsx)("text",{x:480,y:178.20000000000002,fontSize:n.fontSize,fontFamily:n.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:t}),(0,d.jsx)("text",{x:480,y:405,fontSize:n.fontSize,fontFamily:n.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:a})]})},W=(e,t,a)=>({newSvgText:(0,E.F0)((0,d.jsx)(R,{line1:e,line2:t,svgTemplateInputs:a})),svgImageLabel:e+" "+t}),P=e=>{console.log("IN FORM PROVIDER - 2");const[t,a]=(0,n.useState)("QROMA"),[s,i]=(0,n.useState)("HAT");return(0,n.useEffect)((()=>{e.svgGenerationInputsUpdateFn(W(t,s,e.templateInputs))}),[t,s,e.templateInputs]),(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(U.A,{spacing:2,children:[(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 1",value:t,onChange:e=>{const t=e.target.value;a(t)}}),(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 2",value:s,onChange:e=>{const t=e.target.value;i(t)}})]})})},H=e=>{let{line1:t,line2:a,line3:n,svgTemplateInputs:s}=e;return(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",version:"1.1",baseProfile:"full",width:o,height:g,children:[(0,d.jsx)("rect",{width:"100%",height:"100%",fill:"white",stroke:"black",strokeWidth:s.borderWidth,strokeOpacity:"1.0"}),(0,d.jsx)("text",{x:480,y:108,fontSize:s.fontSize,fontFamily:s.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:t}),(0,d.jsx)("text",{x:480,y:270,fontSize:s.fontSize,fontFamily:s.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:a}),(0,d.jsx)("text",{x:480,y:432,fontSize:s.fontSize,fontFamily:s.fontFamily,textAnchor:"middle",dominantBaseline:"middle",fill:"black",children:n})]})},z=(e,t,a,n)=>({newSvgText:(0,E.F0)((0,d.jsx)(H,{line1:e,line2:t,line3:a,svgTemplateInputs:n})),svgImageLabel:e+" "+t+" "+a}),O=e=>{console.log("IN FORM PROVIDER - 2");const[t,a]=(0,n.useState)("FIRST"),[s,i]=(0,n.useState)("GENERATION"),[r,o]=(0,n.useState)("PERFECT"),[g,c]=(0,n.useState)("arial"),[m,p]=(0,n.useState)(140);return(0,n.useEffect)((()=>{e.svgGenerationInputsUpdateFn(z(t,s,r,{...e.templateInputs,fontSize:m}))}),[t,s,r,e.templateInputs]),(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(U.A,{spacing:2,children:[(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 1",value:t,onChange:e=>{const t=e.target.value;a(t)}}),(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 2",value:s,onChange:e=>{const t=e.target.value;i(t)}}),(0,d.jsx)(l.A,{id:"outlined-required",label:"Line 3",value:r,onChange:e=>{const t=e.target.value;o(t)}})]})})},B=e=>{const[t,a]=(0,n.useState)(null),[s,l]=(0,n.useState)(null);return(0,d.jsxs)("div",{children:[(0,d.jsx)("input",{type:"file",onChange:e=>{const t=e.target.files?.[0];l(t)}}),(0,d.jsx)("button",{onClick:()=>{if(!s)return;const t=new FileReader;t.onloadend=()=>{const n=t.result;a(n),e.onNewImageDataUrl(n)},t.readAsDataURL(s)},children:"Upload"}),t&&(0,d.jsx)("img",{src:t,alt:"uploaded"})]})},V="Put Image Name Here",q=e=>{let{embeddedImageUrl:t}=e;return(0,d.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",version:"1.1",width:o,height:g,children:[(0,d.jsx)("rect",{width:"100%",height:"100%",fill:"white",stroke:"black",strokeWidth:"20",strokeOpacity:"1.0"}),(0,d.jsx)("image",{x:"190",y:"65",xlinkHref:t})]})},M=(e,t)=>({newSvgText:(0,E.F0)((0,d.jsx)(q,{embeddedImageUrl:e})),svgImageLabel:t}),Q=e=>{let{svgGenerationInputsUpdateFn:t}=e;const[a,s]=(0,n.useState)(V),[i,r]=(0,n.useState)("");return(0,n.useEffect)((()=>{t(M(i,a))}),[i,a]),(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(U.A,{spacing:2,children:[(0,d.jsx)(B,{onNewImageDataUrl:e=>{r(e)}}),(0,d.jsx)(l.A,{id:"outlined-required",label:"Image Name",value:a,onChange:e=>{const n=e.target.value;s(n),t(M(i,a))}},"single-line-text-line1-input")]})})},$=[{templateTitle:"Double Line",defaultSvgToGrayscaleInputs:e=>W("","",e),formProvider:e=>(0,d.jsx)(P,{svgGenerationInputsUpdateFn:e.svgGenerationInputsUpdateFn,templateInputs:e.templateInputs})},{templateTitle:"Single Line",defaultSvgToGrayscaleInputs:e=>L(C,e),formProvider:e=>(0,d.jsx)(k,{svgGenerationInputsUpdateFn:e.svgGenerationInputsUpdateFn,templateInputs:e.templateInputs})},{templateTitle:"Triple Line",defaultSvgToGrayscaleInputs:e=>z("","","",e),formProvider:e=>(0,d.jsx)(O,{svgGenerationInputsUpdateFn:e.svgGenerationInputsUpdateFn,templateInputs:e.templateInputs})},{templateTitle:"Embedded Image",defaultSvgToGrayscaleInputs:()=>M("",V),formProvider:e=>(0,d.jsx)(Q,{svgGenerationInputsUpdateFn:e.svgGenerationInputsUpdateFn})}],_=e=>{const[t,a]=(0,n.useState)(!1),l=(e,t,a)=>{if(null===e)return null;const n=parseInt(e);return n>=t&&n<=a?n:null};return(0,d.jsx)(d.Fragment,{children:(0,d.jsxs)(s.A,{sx:{borderColor:"divider"},children:[(0,d.jsxs)(A.Ay,{container:!0,spacing:2,children:[(0,d.jsx)(A.Ay,{item:!0,xs:8,children:(0,d.jsxs)(T.A,{fullWidth:!0,children:[(0,d.jsx)(y.A,{id:"svg-template-select-label",children:"SVG Template"}),(0,d.jsx)(F.A,{labelId:"svg-template-select-label",id:"svg-template-select",value:e.svgTemplateIndex,label:"SVG Template",onChange:t=>{const a=t.target.value;console.log("SVG TEMPLATE INDEX: "+a);const n=$[a];e.onNewSvgTemplateSelected(a,n)},children:$.map(((e,t)=>(0,d.jsx)(G.A,{value:t,children:e.templateTitle},e.templateTitle)))})]})}),(0,d.jsx)(A.Ay,{item:!0,xs:4,children:(0,d.jsx)(D.A,{onClick:()=>a(!t),children:t?"Hide Settings":"Settings"})}),t?(0,d.jsx)(A.Ay,{item:!0,xs:12,children:(0,d.jsxs)(U.A,{spacing:2,children:[(0,d.jsxs)("div",{children:["Font Size: ",e.svgTemplateInputs.fontSize,(0,d.jsx)("button",{onClick:()=>{const t=window.prompt("Choose new font size (20-300)",e.svgTemplateInputs.fontSize.toString());console.log("NEW FONT SIZE: "+t);const a=l(t,20,300);null!==a&&e.onNewSvgTemplateInputs({...e.svgTemplateInputs,fontSize:a})},children:"Change"})]}),(0,d.jsxs)("div",{children:["Border Thickness: ",e.svgTemplateInputs.borderWidth,(0,d.jsx)("button",{onClick:()=>{const t=window.prompt("Choose new border thickness (20-300)",e.svgTemplateInputs.borderWidth.toString());console.log("NEW BORDER THICKNESS: "+t);const a=l(t,20,300);null!==a&&e.onNewSvgTemplateInputs({...e.svgTemplateInputs,borderWidth:a})},children:"Change"})]})]})}):null]}),(0,d.jsx)("div",{})]})})};var X=a(2979);class K extends X.ImmerReducer{setSvgText(e){if(this.draftState.svgImageText!==e){this.draftState.svgImageText=e;const t=I(e);this.draftState.svgImageAsDataUrl=t}}setGsImageLabel(e){this.draftState.gsImageLabel!==e&&(this.draftState.gsImageLabel=e)}setImageGrayscaleData(e){this.draftState.grayscaleData=e}setSvgToGrayscaleTemplate(e){this.draftState.svgToGrayscaleTemplate!==e&&(this.draftState.svgToGrayscaleTemplate=e)}setSvgImageAsDataUrl(e){this.draftState.svgImageAsDataUrl!==e&&(this.draftState.svgImageAsDataUrl=e)}setSvgTemplateInputs(e){console.log(e),this.draftState.svgTemplateInputs!==e&&(this.draftState.svgTemplateInputs=e)}}const Y=(0,X.createActionCreators)(K),Z=(0,X.createReducerFunction)(K),J=()=>{const e=(e=>{const t={fontFamily:"arial",fontSize:170,borderWidth:20,imageTypesFilePath:"../../images/image_types.h",imageGroupNameRoot:"frank_hats_season2"};return{svgImageText:e.defaultSvgToGrayscaleInputs(t).newSvgText,svgImageAsDataUrl:"",grayscaleData:{dataAsUint8Array:new Uint8ClampedArray,dataAsNibbles:[],imageHeightInPixels:0,imageWidthInPixels:0,imageLabel:"UNLABELED IMAGE"},gsImageLabel:"NO LABEL SET YET",svgToGrayscaleTemplate:e,svgTemplateInputs:t}})($[0]),[t,a]=(0,n.useState)(0),[s,l]=(0,n.useReducer)(Z,e),i=e=>{l(Y.setSvgText(e.newSvgText)),l(Y.setGsImageLabel(e.svgImageLabel))};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{style:{},children:(0,d.jsx)(w,{componentState:s,onNewGrayscaleData:e=>{l(Y.setImageGrayscaleData(e))},onNewSvgImageAsDataUrl:e=>{l(Y.setSvgImageAsDataUrl(e))}})}),(0,d.jsx)("div",{style:{marginBottom:20}}),(0,d.jsx)(_,{svgTemplateIndex:t,onNewSvgTemplateSelected:(e,t)=>{a(e),l(Y.setSvgToGrayscaleTemplate(t))},onGenerateNewSvg:e=>{i(e)},onSvgTemplateFormUpdate:(e,t)=>{},svgTemplateInputs:s.svgTemplateInputs,onNewSvgTemplateInputs:e=>{l(Y.setSvgTemplateInputs(e))}}),(0,d.jsx)("div",{style:{marginBottom:20}}),$[t].formProvider({templateInputs:s.svgTemplateInputs,svgGenerationInputsUpdateFn:i})]})}}}]);